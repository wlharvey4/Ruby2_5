<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- 
Copyright (C) 2018 

wlharvey4 

All Rights Reserved.

The Ruby2.5 Information and Documentation program is copyright
(C) 2018 by wlharvey4. It is published under
the conditions of the GNU General Public License, version 3.


This is Edition 0.3f of Ruby 2.5 Information and Documentation. -->
<!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>apiutil.awk MAIN Block (Ruby2_5 Information)</title>

<meta name="description" content="apiutil.awk MAIN Block (Ruby2_5 Information)">
<meta name="keywords" content="apiutil.awk MAIN Block (Ruby2_5 Information)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="API-Utility.html#API-Utility" rel="up" title="API Utility">
<link href="apiutil_002eawk-ENDFILE-Block.html#apiutil_002eawk-ENDFILE-Block" rel="next" title="apiutil.awk ENDFILE Block">
<link href="apiutil_002eawk-BEGNFILE-Block.html#apiutil_002eawk-BEGNFILE-Block" rel="prev" title="apiutil.awk BEGNFILE Block">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<a name="apiutil_002eawk-MAIN-Block"></a>
<div class="header">
<p>
Next: <a href="apiutil_002eawk-ENDFILE-Block.html#apiutil_002eawk-ENDFILE-Block" accesskey="n" rel="next"><samp>apiutil.awk</samp> ENDFILE Block</a>, Previous: <a href="apiutil_002eawk-BEGNFILE-Block.html#apiutil_002eawk-BEGNFILE-Block" accesskey="p" rel="prev"><samp>apiutil.awk</samp> BEGNFILE Block</a>, Up: <a href="API-Utility.html#API-Utility" accesskey="u" rel="up">API Utility</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html#Concept-Index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="apiutil_002eawk-MAIN-Block-1"></a>
<h4 class="appendixsubsec">A.2.3 <samp>apiutil.awk</samp> MAIN Block</h4>

<p>The <code>MAIN</code> block basically finds the beginning and ending of the tables I
am parsing, and passes everything else through unchanged.  It uses the flag
<code>started</code> to pass through the beginning and ending lines basically
unchanged as well.
</p>
<p>The real work is done on lines that are in the middle of the tables.  There is
first a regular expression check to make sure something is on the line because
some lines are empty and are just ignored; plus, it passes over lines with @
commands.  After it finds a non-empty line, <samp>GAWK</samp> parses it into the
array <code>arr</code> using the function <code>match</code>, and then it prints the parsed
elements.
</p>
<p><code>arr[1]</code> is used by both tables to produce either a <code>C</code> or an
<code>M</code>, meaning <code>Class</code> or <code>Module</code> (from the <code>Class</code> table),
or a <code>::</code> or <code>#</code> (from the <code>Method</code> table) meaning class method
or instance method.  These are used by the <code>classmethod</code> hash to produce a
more meaningful description.
</p>
<p><code>arr[2]</code> is used to hold the substantive name of the element.
</p>
<p><code>arr[3]</code> is ignored, as it wraps whatever is in parentheses) (i.e., it
&ldquo;removes&rdquo; the parentheses).
</p>
<p><code>arr[4]</code> contains the class for which a method is associated (from the
<code>Method</code> table).
</p>
<p>Once the parsing has been completed, the parts are printed with appropriate
commands surrounding them, i.e., <code>@item</code> or <code>@code</code>, etc.
</p>
<a name="apiutil_002d_002d_002dMAIN_002dBlock"></a><a name="index-_003capiutil_002d_002d_002dMAIN-Block_003e_002c-definition"></a>
<p><span class="roman">&lt;<i>apiutil&mdash;MAIN Block</i>&gt;</span> &equiv;
</p><div class="example">
<pre class="example"># pass through whatever is not in a target table
started == 0 { print $0 &gt; newfile }

# process whatever is inside a target table;
# turn on the 'started' flag the first time it is entered
# plus ignore the first line (which is @float)
$0 ~ start, $0 ~ end {
   if (started == 0) {
     started = 1
     next
   }

   # ignore the @table line
   if ($0 ~ /^@table/) {
     print $0 &gt; newfile
     next
   }

   # at the end of a table, add an empty line for better style
   # and turn off the 'started' flag
   if ($0 ~ end) {
     print &quot;\n&quot;$0 &gt; newfile
     started = 0
     next
   }

   # main work is done here
   # parse a table row and print some formatted table rows
   if ($0 ~ /^[CM]?[[:graph:]]+.*$/) {

     # the parsing uses parenthesized sections to place information
     # into the array 'arr'
     cm = match($0, /([CM]|[:#]+)?([^(]+)(\(([^)]+))?/, arr)

     print &quot;@item &quot;arr[2] &gt; newfile

     # arr[4] is a parenthesized Class associated with a method
     if (length(arr[4]) &gt; 0) {
       arr[4] = &quot;@file{&quot;arr[4]&quot;} &quot;
     }

     print (arr[4])(classmethod[arr[1]]) &gt; newfile

   } else {
     print &gt; newfile
   }
}
</pre></div>

<p>This chunk is called by <span class="roman">{<samp>apiutil.awk</samp>}</span>; see its first definition at <a href="API-Utility.html#apiutil_002dawk">apiutil-awk</a>.
</p>


<hr>
<div class="header">
<p>
Next: <a href="apiutil_002eawk-ENDFILE-Block.html#apiutil_002eawk-ENDFILE-Block" accesskey="n" rel="next"><samp>apiutil.awk</samp> ENDFILE Block</a>, Previous: <a href="apiutil_002eawk-BEGNFILE-Block.html#apiutil_002eawk-BEGNFILE-Block" accesskey="p" rel="prev"><samp>apiutil.awk</samp> BEGNFILE Block</a>, Up: <a href="API-Utility.html#API-Utility" accesskey="u" rel="up">API Utility</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html#Concept-Index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
